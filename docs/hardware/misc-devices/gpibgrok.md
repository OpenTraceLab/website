# Gpibgrok
This page documents some ideas and information for a GPIB-USBTMC hardware interface.
## Contents
\- *1 Motivation* \- *2 Hardware design* \- *3 Firmware* \- *4 Components* \- *4.1 GPIB connectors* \- *4.2 GPIB protocol chips* \- *4.3 GPIB transceiver chips* \- *5 Bill of materials* \- *6 Resources* \- *7 Volunteers*
## Motivation There are many ways to communicate with devices that have a GPIB port, and OpenTraceLab aims to support as many of them as possible (see *IEEE-488*). However in this day and age the only reasonable interface for this would have to use a USB device port, since USB host ports are so ubiquitous. The USB standards include a device class specifically made for test and measurement, called the [USBTMC](http://www.usb.org/developers/docs/devclass_docs/USBTMC_1_006a.zip) class. Yet most of the GPIB-USB interfaces available don't use this device class; they typically use either a proprietary protocol or serial emulation. The originator on this project, *Uwe_Hermann*, thought that the [TEK-USB-488](http://www.tek.com/datasheet/gpib-usb-adapter) interface from Tektronix was being able to act as a controller (and it's ridiculously overpriced at around \$740). But this interface is actually an USB host controller for a device already implementing USBTMC device class, and making it (and only this one) reachable through GPIB; e.g. making an USB-only oscilloscope implementing the USBTMC class reachable through GPIB. There is even an additional USB protocol to be implemented by this device to be able to control the GPIB address it will appear on. Thus, making a GPIB controller interfaced through this USBTMC class may not be possible, IMHO ([Benoar](https://OpenTraceLab.org/w/index.php?title=User:Benoar&action=edit&redlink=1 "User:Benoar \(page does not exist\)")). We think we can make a GPIB-USBTMC interface that is: \- 100% free and open source, hardware and firmware/software \- 100% standards-compliant \- Considerably cheaper than anything else out there (less than \$50) In addition, since we'd be making essentially a "server-side" i.e. USB device-side implementation of the USBTMC protocol, this code would be reusable in projects such as [Das Oszi](http://elinux.org/Das_Oszi). ## Hardware design \- STM32L0 ARM Cortex M0 \- Built-in FS USB with crystal-less operation \- Compatible with libopencm3 \- 32 pin LQFP keeps size low and assembly easy \- Specialty transceivers \- TI still makes the SN75160 (data) and SN75161 (handshake) \- High current drive required for logic lines according to GPIB standard \- Directional bundling of pins based on protocol simplifies firmware \- Two-layer PCB to keep cost low \- Designed to fit in L-COM housing for CIB24S GPIB connector \- Saves effort on custom enclosure \- Current design hosted at [Upverter](https://upverter.com/lieser/def8f424a80b0d5a/gpibgrok/) ## Firmware This is more of a TODO list at the moment: \- Start with libopencm3 \- Add new class for USBTMC \- GPIB \- Implement functions \- Serial poll \- Write \- Read \- Reset \- Local lockout \- Monitor and handle SRQs \- Commands \- All data is just passed thru from PC to GPIB device and back, parsing of SCPI or other protocols is not required in firmware \- Firmware update \- Use the DFU bootloader in libopencm3 \- Modify to check register for boot flag instead of hardware pin \- Some special command in USBTMC can set to bootloader mode and reset processor, then when DFU is done, set flag back and boot to main ## Components ### GPIB connectors \- Right-angle, PCB mounted, male: \- Norcomp 112-024-113R001: [about $5.5](http://octopart.com/partsearch#search/requestData&q=Norcomp+112-024-113R001); [Mouser](http://de.mouser.com/ProductDetail/NorComp/112-024-113R001/?qs=IGgAdOvCTsSdej4q2f%2fo5Q%3d%3d) (2.80€, but not available ATM), [Digi-Key](http://www.digikey.de/product-search/de?x=0&y=0&lang=de&site=de&KeyWords=112-024-113R001) (4.59€) \- TE Connectivity 5552741-1: [about $7.2](http://octopart.com/partsearch#search/requestData&q=TE%20Connectivity%205552741-1); [Mouser](http://de.mouser.com/ProductDetail/TE-Connectivity-AMP/5552741-1/?qs=ZDXmSm13592KDB5YbnOqGQEXH8vBFTre66B%2ffSd9ajU%3d) (5.87€, but not available, and minimum quantity required), [Digi-Key](http://www.digikey.de/scripts/dksearch/dksus.dll?vendor=0&keywords=5552741-1) (7.50€) \- Straight (no right-angle), PCB mounted, male: \- [TE Connectivity / AMP 552283-1](http://www.te.com/catalog/pn/en/552283-1): [Mouser](http://de.mouser.com/ProductDetail/TE-Connectivity-AMP/552283-1/?qs=L%252bK8JgcrFouKshZpXbu%2foxXjsnB6QVdhWc5JSE3CA%2fU%3d) (4.08€), [Digi-Key](http://www.digikey.de/scripts/dksearch/dksus.dll?vendor=0&keywords=552283-1) (4.51€, but EOL soon? Minimum quantity?) \- Straight (no right-angle), solder-cup, male: \- [Norcomp 111-024-103L001](http://www.norcomp.net/rohspdfs/SCSI-050Ribbon/11Y/111/111-YYY-103L001.pdf): [Digi-Key](http://www.digikey.de/product-detail/de/111-024-103L001/1024MA-ND/955139) (2.90€) \- [Amphenol 57-20240](http://www.amphenolcanada.com/ProductSearch/drawings/AC/5720240.pdf): [Mouser](http://de.mouser.com/ProductDetail/Amphenol-Commercial-Products/57-20240/?qs=9QC6KritiMlxI%2fbOR6fN8o%2fx9VH%2fvGRssdGjBll89tQ%3d) (4.93€) TODO: Typo on page/datasheet, or is this really female? \- Straight (no right-angle), solder, male: \- [Norcomp 111-024-113L001](http://www.norcomp.net/rohspdfs/SCSI-050Ribbon/11Y/111/111-YYY-113L001.pdf): [Digi-Key](http://www.digikey.de/product-detail/de/111-024-113L001/1024PMA-ND/955147) (4.54€) \- Straight (no right-angle), solder-cup/cable, male: \- [Amphenol 57-30240](http://www.amphenolcanada.com/ProductSearch/drawings/AC/5730240.pdf): [Mouser](http://de.mouser.com/ProductDetail/Amphenol-Commercial-Products/57-30240/?qs=2ZPlowQld1N7RBj5X0pv8db%252b15EhuRSLDpapiRNYO6M%3d) (7.19€), Digi-Key: N/A \- Straight (no right-angle), ribbon cable, male: \- MULTICOMP 5F30240P-10NN-XX: [Farnell](http://de.farnell.com/multicomp/5f30240p-10nn-xx/stecker-centronics-24-pol/dp/1099278) (2.31€) ### GPIB protocol chips \- [Philips/NXP HEF4738](http://www.datasheetarchive.com/dl/Datasheets-25/DSA-488752.pdf) \- [Fairchild 96LS488](http://www.datasheetarchive.com/dl/Datasheets-112/DSAP0051077.pdf) \- [NEC uPD7210C/D](http://www.datasheetarchive.com/dl/Datasheets-24/DSA-476449.pdf) \- [National Instruments NAT7210](http://sine.ni.com/nips/cds/view/p/lang/en/nid/10626): "Drop-In Replacement Chip for NEC µPD7210 Controller" ([datasheet](http://www.ni.com/pdf/products/us/4gpib704.pdf)) \- [National Instruments NAT9914](http://sine.ni.com/nips/cds/view/p/lang/de/nid/11153): "Drop-In Replacement Chips for TI TMS9914A Controllers" ([datasheet](http://www.ni.com/pdf/products/us/4gpib705.pdf)) \- [National Instruments TNT4882](http://sine.ni.com/nips/cds/view/p/lang/en/nid/12149): "High-Performance, Lower-Cost Single-Chip GPIB Talker/Listener ASIC" ([datasheet](http://www.ni.com/pdf/products/us/4gpib702-703.pdf)) \- [National Instruments TNT5002](http://sine.ni.com/nips/cds/view/p/lang/en/nid/12150): "Single-Chip PCI-to-GPIB Talker/Listener ASIC" ([datasheet](http://www.ni.com/pdf/products/us/4gpib700-701.pdf)) (Pretty much all of them are no longer available, or horribly expensive, or hard to get, or a combination thereof.) ### GPIB transceiver chips \- [National DS75160A/61A/62A](http://www.datasheetarchive.com/dl/Datasheets-21/DSA-418241.pdf) \- [SN75160B: Octal General-Purpose Interface Bus Transceiver](http://www.ti.com/product/sn75160b) ([datasheet](http://www.ti.com/lit/gpn/sn75160b)). [Mouser: 1.55€](http://de.mouser.com/ProductDetail/Texas-Instruments/SN75160BDW/?qs=Dqy2GfToSoRN7kS7RA4kUqt%252bApV44GjizjHa8zhcESY%3d), [Digi-Key](http://www.digikey.de/product-detail/de/SN75160BDW/296-6844-5-ND/370216) (2.33€) \- [SN75161B: Octal General-Purpose Interface Bus Transceiver](http://www.ti.com/product/sn75161b) ([datasheet](http://www.ti.com/lit/gpn/sn75161b)). [Mouser: 1.45€](http://de.mouser.com/ProductDetail/Texas-Instruments/SN75161BDW/?qs=Dqy2GfToSoSEk6hSOlXO6PWl2ZlfYL4DQU8qvn8WRzg%3d), [Digi-Key](http://www.digikey.de/product-detail/de/SN75161BDWR/296-14951-1-ND/562537) (2.74€) \- [SN75162B: Octal General-Purpose Interface Bus Transceiver](http://www.ti.com/product/sn75162b) ([datasheet](http://www.ti.com/lit/gpn/sn75162b)). [Mouser: 2.03€](http://de.mouser.com/ProductDetail/Texas-Instruments/SN75162BDW/?qs=Dqy2GfToSoQt2q38QBjULg%3d%3d), [Digi-Key](http://www.digikey.de/scripts/dksearch/dksus.dll?vendor=0&keywords=SN75162&stock=1) (2.33€) ## Bill of materials | | | | | | | | |:------------------------------------------------------------------------|:-------------------|:-------------------|:-----------|:---------|:---------|:-------| | Description | Manufacturer | Part Number | Package | Quantity | Vendor | Price | | Generic Capacitor 100nF 10V | any | | 0603 | 5 | | \$0.10 | | Generic Capacitor 1 µF 10V | any | | 0603 | 2 | | \$0.10 | | Chip LED | Lite-On | LTST-C193TBKT-5A | 0603 | 1 | Digi-Key | \$0.47 | | SMT Micro USB Female right-angle bottom-mount connector type B | Molex | 473460001 | Receptacle | 1 | Newark | \$0.52 | | Connector, GPIB Sldr, Female | L-COM | CIB24S | | 1 | L-COM | \$8.02 | | Generic Resistor (0.0R) | any | | 0603 | 2 | | \$0.10 | | Generic Resistor (30) | any | | 0603 | 1 | | \$0.10 | | Common mode filter with ESD protection for USB 2.0 interface | STMicroelectronics | ECMF02-4CMX8 | QFN-8L | 1 | Arrow | \$0.54 | | Octal Transceiver GPIB Control | Texas Instruments | SN75161BDW | SOIC | 1 | Arrow | \$1.60 | | LP2980-N Micropower 50-mA Ultra Low-Dropout Regulator in SOT-23 Package | Texas Instruments | LP2980IM5-3.3/NOPB | SOT-23-5 | 1 | Arrow | \$0.43 | | Octal Transceiver GPIB Data bus | Texas Instruments | SN75160BDW | SOIC | 1 | Digikey | \$2.18 | | 32-bit MCU ARM Cortex-M0+, 64 KB Flash, 8 KB SRAM, 2 KB EEPROM, USB | STMicroelectronics | STM32L062K8T6 | LQFP32 | 1 | Arrow | \$2.33 | ## Resources \- Massimiliano Gentile's [thesis](http://home.dei.polimi.it/bellasi/lib/exe/fetch.php?media=students:gentile_finalreport.pdf) on writing a USBTMC driver for the AVR32 architecture. \- [Hack a Day: GPIB connectivity twofer](http://hackaday.com/2012/05/01/gpib-connectivity-twofer/) (covers Galvant GPIBUSB and Sven Pauli's RS232-GPIB interface) \- [GPIB connector pinout](http://digital.ni.com/public.nsf/allkb/9BB2417C09C4D08786256BE9007D7B55) \- [news of a USBTMC driver for TinyUSB stack](https://www.eevblog.com/forum/projects/usbtmcusb488-class-implementation-for-microcontrollers/msg2704048/#msg2704048) ## Volunteers Please edit this section with your name and (public) contact details if you are interested in developing this. \- [User:Ivan747](https://OpenTraceLab.org/w/index.php?title=User:Ivan747&action=edit&redlink=1 "User:Ivan747 \(page does not exist\)") (same nick on IRC), experience in hardware, low level firmware (but not USB). Willing to participate with the support from someone experienced in USB protocols on any kind of ARM device. Contact: ivan747\\[at\\]users.sourceforge.net.  \- [User:Elbridge](https://OpenTraceLab.org/w/index.php?title=User:Elbridge&action=edit&redlink=1 "User:Elbridge \(page does not exist\)") (same nick in IRC), experienced with hardware and firmware, but new to open source.
Retrieved from "[https://OpenTraceLab.org/w/index.php?title=Gpibgrok&oldid=16375](https://OpenTraceLab.org/w/index.php?title=Gpibgrok&oldid=16375)"
: \- *GPIB interface*
## See Also
- [Supported Hardware Overview](../supported-hardware.md)
- [OpenTraceCapture Documentation](../../opentracecapture/overview.md)
